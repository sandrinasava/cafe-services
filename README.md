# Микросервисное Приложение для Управления Заказами Ресторана
### Описание
Этот проект представляет собой микросервисное приложение для управления заказами в ресторане. Оно состоит из трех основных сервисов: приема заказов, кухни и доставки. Приложение использует различные технологии и инструменты для обеспечения эффективной работы и масштабируемости.

### Компоненты
- Order Service
Принимает новые заказы от клиентов.
Публикует события о новых заказах в Kafka.
Хранит заказы в кэше Redis для быстрого доступа.
- Kitchen Service
Подписывается на события о новых заказах из Kafka.
Обрабатывает заказы (например, готовит пиццу).
Обновляет статус заказа и публикует события о готовности заказа.
- Delivery Service
Подписывается на события о готовности заказа из Kafka.
Обрабатывает доставку заказа.
Сохраняет информацию о доставке в базу данных PostgreSQL.

---

### Технологии и Инструменты
- **Язык:** Go 1.24
- **Брокер сообщений:** Apache Kafka
- **Кэширование:** Redis
- **База данных:** PostgreSQL 
- **Docker-деплой:** Docker Compose

---

### Запуск проекта

Order Service
Функциональность:

Принимает запросы на создание заказа.
Отправляет сообщение в Kafka для Cooking Service.
Технологии:

gRPC для взаимодействия с Auth Service.
Kafka для отправки сообщений в Cooking Service.

Auth Service
Функциональность:

Хранит хешированные пароли пользователей.
Генерирует и проверяет JWT токены.
Технологии:

gRPC для взаимодействия с другими микросервисами.
База данных (например, SQLite) для хранения пользователей.


Cooking Service
Функциональность:

Имитирует процесс приготовления заказа с помощью таймаута.
Отправляет сообщение в Kafka для Delivery Service после завершения приготовления.
Технологии:

Kafka для получения сообщений от Order Service и отправки сообщений в Delivery Service.

Delivery Service
Функциональность:

Имитирует процесс доставки заказа с помощью таймаута.
Обновляет статус заказа в базе данных.
Технологии:

Kafka для получения сообщений от Cooking Service.
База данных (например, SQLite) для хранения статуса заказов.
3. Взаимодействие микросервисов
gRPC:

Используйте Protocol Buffers для определения сообщений и сервисов.
Реализуйте клиенты и серверы gRPC для взаимодействия между микросервисами.
Kafka:

Настройте топики для каждого типа сообщений (например, order_created, order_cooked, order_delivered).
Используйте библиотеку Kafka для Go (например, sarama) для отправки и получения сообщений.

# Cafe-services

Cafe-services - микросервисное приложение, для управления заказами в ресторане. Оно состоит из четырех основных сервисов: приема заказов, аутентификации, кухни и доставки. Приложение использует различные технологии и инструменты для обеспечения эффективной работы и масштабируемости. 

## Технологии и Инструменты
- **Язык:** Go 1.23.3
- **Брокер сообщений:** Apache Kafka
- **Кэширование:** Redis
- **База данных:** PostgreSQL 
- **Docker-деплой:** Docker Compose
- **Прокси:** Caddy
- **Api:** gRPC, REST
- **CI/CD** GitHub Actions
  - Протоколы и Генерация кода:
  .proto файл хранится в https://github.com/sandrinasava/proto-definitions и при изменении автоматически обновляет 
  сгенерированный код в https://github.com/sandrinasava/go-proto-module



# Компоненты:

## auth-service
- Добавление/удаление задач
- Редактирование существующей задачи
- Возможность установить правило повторения задачи
- Поиск по ключевым словам (регистрозависимый поиск)
- Поиск по дате в формате дд.мм.гггг

| Правило повторения                | Описание                                                                 | Пример          |
| ---------------------------------- | ------------------------------------------------------------------------ | --------------- |
| `d <число от 1 до 400>`            | Задача переносится на указанное число дней                             | `d 60`          |
| `y`                                | Задача выполняется ежегодно                                             | `y`             |
| `w <от 1 до 7>`                    | Задача назначается в указанные дни недели                              | `w 1,4,5`  Задача перенесётся на ближайший понедельник, четверг или пятницу      |
| `m <от 1 до 31,-1,-2> [от 1 до 12]` | <div>Задача назначается в указанные дни месяца.<br>Вторая часть опциональна, указывает на определённый месяц.</div> | `m 1,-1 2,8` Задача назначается на 1-е и последнее число февраля и авгуcта|


## Технологический стек:
- **Язык:** Go 1.23
- **База данных:** SQLite
- **Юнит-тесты:** testify
- **Инфраструктура:** Docker


## Запуск проекта

URL для доступа к приложению будет `http://localhost:${APP_PORT}/`

### Локальный запуск:
```bash
 go run ./cmd/main.go 
 ```

### Запуск в контейнере:

```bash
docker build --tag my-app:v1 ./cmd  
```
```bash
docker run -p ${TODO_PORT}:${TODO_PORT} my-app:v1 
```
### Тестирование:

```bash
go test ./...  
```
## Использование API

### 1. Найти следующую дату:

- **Эндпоинт:** `/api/nextdate`
- **Метод:** `GET`
- **URL-параметры:**
`now` - дата ггггммдд `date` - дата ггггммдд `repeat` - правило повторения
- **Пример ответа:**
`20250126`

### 2. Добавить/удалить/найти по id/изменить задачу:

- **Эндпоинт:** `/api/task`
- **Метод:** `POST/DELETE/GET/PUT`
- **Пример тела запроса для POST:**
  ```json
  {
    "comment": "",
    "date": "20250321",
    "repeat": "y",
    "title": "купить подарок на др"
  }
  ```
- **Пример тела ответа для POST:**
  ```json
  {"id": "2"}
  ```

  ### 3. Отметить задачу выполненной:

- **Поиск следующей даты**
- **Эндпоинт:** `/api/task/done`
- **Метод:** `POST`
- **URL-параметры:**
`id: 1` 
- **Пример тела ответа для POST:**
  ```json
  {}
  ```
### 4. Показать список задач:

- **Эндпоинт:** `/api/tasks`
- **Метод:** `POST/DELETE/GET/PUT`
- **URL-параметр:**(опционально)
`search: купить` 

- **Пример тела ответа:**

```json
{
  "tasks": [
    {
     "comment": "",
    "date": "20250321",
    "repeat": "y",
    "title": "купить подарок на др"
    },
    {
    "comment": "",
    "date": "20250325",
    "repeat": "",
    "title": "купить рис"
    }
  ]
}